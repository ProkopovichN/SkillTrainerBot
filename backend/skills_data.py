"""
Skills Training Data Structure
3 Blocks x 14 Skills = 42 Total Skills

Block 1: Performance Review & Feedback (Оценка результативности и обратная связь)
Block 2: Development Planning (Планирование развития)
Block 3: Meeting & Communication Skills (Навыки проведения встреч и коммуникации)
"""

from typing import Dict, List, Any

SKILL_BLOCKS = {
    "block_1": {
        "id": "block_1",
        "name": "Оценка результативности и обратная связь",
        "name_en": "Performance Review & Feedback",
        "description": "Навыки оценки результатов работы сотрудников и предоставления обратной связи",
        "skills": [
            {
                "id": "skill_1_1",
                "name": "Применение шкалы рейтингов",
                "description": "Умение корректно применять шкалу рейтингов при оценке сотрудников",
                "theory_doc": "1. Критерии присвоения рейтингов performance ревью.txt",
                "situations": [
                    "Сотрудник выполнил все цели в срок, но без превышения показателей. Он ожидает оценку 'Сверхрезультат', но по критериям это 'Хороший результат'. Как объяснить разницу между рейтингами?",
                    "Разработчик сделал важный проект, который повлиял на всю компанию, но при этом нарушил несколько этических норм в коммуникации с коллегами. Какой рейтинг присвоить и как это обосновать?",
                ]
            },
            {
                "id": "skill_1_2",
                "name": "Оценка наблюдаемого поведения",
                "description": "Умение оценивать только наблюдаемое поведение с конкретными примерами",
                "theory_doc": "1. Критерии присвоения рейтингов performance ревью.txt",
                "situations": [
                    "Вам нужно оценить сотрудника, но вы работаете с ним удалённо и редко видите его работу напрямую. Как собрать примеры наблюдаемого поведения для объективной оценки?",
                    "Коллеги говорят, что сотрудник 'не командный игрок', но конкретных примеров не приводят. Как перевести это в наблюдаемое поведение для оценки?",
                ]
            },
            {
                "id": "skill_1_3",
                "name": "Структура EECC",
                "description": "Применение структуры Evidence-Effect-Conclusion-Continue при обратной связи",
                "theory_doc": "7. Структура EECC.docx.txt",
                "situations": [
                    "Сотрудник ожидал маркер 'Готов к продвижению', но получил 'Развивается в роли'. Сформулируй обратную связь по структуре EECC, объясняя разрыв между ожиданиями и реальностью.",
                    "Нужно дать обратную связь сотруднику с оценкой 'Хороший результат' — он справился, но не превзошёл ожидания. Как построить EECC так, чтобы это мотивировало, а не разочаровывало?",
                ]
            },
            {
                "id": "skill_1_4",
                "name": "Работа с возражением 'внешние обстоятельства'",
                "description": "Умение работать с возражениями, когда сотрудник ссылается на внешние факторы",
                "theory_doc": "8. Основные возражения сотрудника по итогам Performance review.docx.txt",
                "situations": [
                    "Сотрудник не выполнил KPI и говорит: 'Я сделал всё возможное, но смежный отдел не предоставил данные вовремя'. Как отработать это возражение?",
                    "Менеджер проекта ссылается на то, что заказчик постоянно менял требования, поэтому сроки сорвались. Как разобрать ситуацию и определить зону ответственности сотрудника?",
                ]
            },
            {
                "id": "skill_1_5",
                "name": "Работа с возражением 'незаметный вклад'",
                "description": "Умение работать с ситуацией, когда результат команды есть, но вклад сотрудника неочевиден",
                "theory_doc": "8. Основные возражения сотрудника по итогам Performance review.docx.txt",
                "situations": [
                    "Команда достигла целей, но конкретный сотрудник работал меньше других. Он говорит: 'Результат есть — значит я тоже молодец'. Как ответить?",
                    "Сотрудник утверждает, что много работал над проектом, но его вклад не виден в метриках. Как разобраться — это проблема видимости или реального вклада?",
                ]
            },
            {
                "id": "skill_1_6",
                "name": "Работа с возражением 'неожиданная оценка'",
                "description": "Умение работать с реакцией 'Ты же говорил, что всё хорошо!'",
                "theory_doc": "8. Основные возражения сотрудника по итогам Performance review.docx.txt",
                "situations": [
                    "Сотрудник в шоке: 'Весь год ты говорил, что я на правильном пути, а теперь — низкая оценка!'. Как объяснить расхождение и сохранить доверие?",
                    "После калибровки оценка сотрудника оказалась ниже, чем вы оба ожидали. Как честно признать это и перевести разговор в конструктивное русло?",
                ]
            },
            {
                "id": "skill_1_7",
                "name": "Работа с запросом на пересмотр оценки",
                "description": "Умение работать с сотрудником, который требует пересмотра оценки",
                "theory_doc": "8. Основные возражения сотрудника по итогам Performance review.docx.txt",
                "situations": [
                    "Сотрудник категорически не согласен с оценкой и требует эскалации. Все ваши аргументы он отвергает. Как действовать?",
                    "Сотрудник говорит: 'Я пойду к HR и буду оспаривать решение'. Как реагировать и какие шаги предпринять?",
                ]
            },
            {
                "id": "skill_1_8",
                "name": "Факты vs интерпретации",
                "description": "Умение отделять факты от интерпретаций при обратной связи",
                "theory_doc": "10. Критерии фактов и интерпретаций.docx.txt",
                "situations": [
                    "Вы хотите сказать сотруднику, что он 'безответственный'. Как переформулировать это в факты и наблюдаемое поведение?",
                    "Коллега дал фидбек: 'Он не проактивный'. Как превратить эту интерпретацию в конкретные факты для обратной связи?",
                ]
            },
            {
                "id": "skill_1_9",
                "name": "Оценка лидерских компетенций",
                "description": "Умение оценивать проявление лидерских компетенций",
                "theory_doc": "3. Лидерские компетенции и их проявления.txt",
                "situations": [
                    "Сотрудник хочет стать тимлидом. Как оценить его по компетенции 'Создаёт ясность' и дать конкретную обратную связь?",
                    "Нужно оценить менеджера по компетенции 'Усиливает команду'. Какие вопросы задать себе и какие примеры искать?",
                ]
            },
            {
                "id": "skill_1_10",
                "name": "Калибровка оценок",
                "description": "Понимание принципов калибровки и умение объяснить их сотруднику",
                "theory_doc": "4. (уточнить на полноту) Принципы калибровок.docx.txt",
                "situations": [
                    "Сотрудник спрашивает: 'Почему моя оценка зависит от того, как работают другие? Это же несправедливо!'. Как объяснить принцип калибровки?",
                    "После калибровки вам пришлось снизить оценку сотруднику. Как объяснить это, не раскрывая детали обсуждения других людей?",
                ]
            },
            {
                "id": "skill_1_11",
                "name": "Присвоение карьерных маркеров",
                "description": "Умение корректно присваивать и объяснять карьерные маркеры",
                "theory_doc": "2. (обновить) Критерии присвоения карьерных маркеров talent ревью.txt",
                "situations": [
                    "Сотрудник показывает отличные результаты, но вы ставите маркер 'Развивается в роли', а не 'Готов к продвижению'. Как объяснить разницу?",
                    "Сотрудник получил маркер 'Риск ухода'. Как провести разговор и что предложить?",
                ]
            },
            {
                "id": "skill_1_12",
                "name": "Обратная связь при высокой оценке",
                "description": "Умение давать развивающую обратную связь даже при отличных результатах",
                "theory_doc": "7. Структура EECC.docx.txt",
                "situations": [
                    "Сотрудник получил 'Сверхрезультат'. Как дать обратную связь, которая не только похвалит, но и покажет путь дальнейшего роста?",
                    "Топ-перформер спрашивает: 'Что мне ещё улучшать? Я же и так лучший'. Как ответить конструктивно?",
                ]
            },
            {
                "id": "skill_1_13",
                "name": "Обратная связь при низкой оценке",
                "description": "Умение давать обратную связь при оценке 'Недостаточный результат' или 'Нет результата'",
                "theory_doc": "1. Критерии присвоения рейтингов performance ревью.txt",
                "situations": [
                    "Сотрудник получил оценку 'Недостаточный результат'. Как построить разговор, чтобы он не потерял мотивацию, но понял серьёзность ситуации?",
                    "Вы вынуждены поставить 'Нет результата'. Как сообщить об этом и обсудить дальнейшие шаги?",
                ]
            },
            {
                "id": "skill_1_14",
                "name": "Самооценка руководителя",
                "description": "Умение рефлексировать свои действия как руководителя при оценке сотрудника",
                "theory_doc": "8. Работа с возражениями. Частые ошибки руководителей.docx.txt",
                "situations": [
                    "Сотрудник провалил цели. Прежде чем давать обратную связь, какие вопросы вы должны задать себе о своих действиях как руководителя?",
                    "Вы понимаете, что не давали сотруднику достаточно обратной связи в течение года. Как признать это на ревью и что изменить?",
                ]
            },
        ]
    },
    "block_2": {
        "id": "block_2",
        "name": "Подготовка к встрече",
        "name_en": "Meeting Preparation",
        "description": "Навыки подготовки к проведению ревью-встречи с сотрудником",
        "skills": [
            {
                "id": "skill_2_2",
                "name": "Определение типа ситуации и выбор сценария встречи",
                "description": "Умение определить тип ситуации (позитивная/негативная оценка, ожидаемая/неожиданная) и выбрать соответствующий сценарий",
                "theory_doc": "11. (для теории, с примерами) Цели и задачи этапов встречи.docx.txt",
                "situations": [
                    "Сотрудник ожидает повышение, но получит оценку 'Хороший результат' без промо. Какой тип ситуации это и какой сценарий встречи выбрать?",
                    "У сотрудника оценка 'low', и он об этом не догадывается. Как подготовить сценарий встречи для такой ситуации?",
                ]
            },
            {
                "id": "skill_2_3",
                "name": "Формулирование цели встречи и ожидаемого результата",
                "description": "Умение чётко сформулировать цель встречи и определить, что должно быть достигнуто по её итогам",
                "theory_doc": "11. (для теории, с примерами) Цели и задачи этапов встречи.docx.txt",
                "situations": [
                    "Вам нужно провести ревью с сотрудником, который получил 'Недостаточный результат'. Сформулируйте цель встречи и ожидаемый результат.",
                    "Сотрудник получил отличную оценку и готов к продвижению. Какую цель встречи поставить, чтобы она была не просто 'похвалить'?",
                ]
            },
            {
                "id": "skill_2_4",
                "name": "Формирование повестки и планирование встречи",
                "description": "Умение составить структурированную повестку встречи с учётом всех этапов",
                "theory_doc": "11. (для теории, с примерами) Цели и задачи этапов встречи.docx.txt",
                "situations": [
                    "У вас 45 минут на ревью-встречу. Как распределить время между этапами: установление контакта, синхронизация ожиданий, обратная связь, план развития, завершение?",
                    "Сотрудник эмоциональный, и вы ожидаете сложную реакцию. Как скорректировать стандартную повестку встречи?",
                ]
            },
            {
                "id": "skill_2_5",
                "name": "Отличие фактов от оценочных суждений",
                "description": "Умение отделять наблюдаемые факты от интерпретаций и оценок при подготовке обратной связи",
                "theory_doc": "10. Критерии фактов и интерпретаций.docx.txt",
                "situations": [
                    "Вы хотите сказать сотруднику, что он 'безответственный'. Переформулируйте это в конкретные факты и наблюдения.",
                    "Коллега дал фидбек: 'Он токсичный и демотивирует команду'. Как превратить это в факты для обратной связи?",
                ]
            },
            {
                "id": "skill_2_6",
                "name": "Объяснение последствий поведения для команды",
                "description": "Умение связать конкретное поведение сотрудника с его влиянием на команду и бизнес-результаты",
                "theory_doc": "7. Структура EECC.docx.txt",
                "situations": [
                    "Сотрудник регулярно опаздывает на встречи. Как объяснить влияние этого поведения на команду (Effect в EECC)?",
                    "Разработчик пишет код без документации. Как сформулировать последствия для команды и проекта?",
                ]
            },
            {
                "id": "skill_2_7",
                "name": "Структурирование обратной связи (EECC)",
                "description": "Умение подготовить обратную связь по структуре Evidence-Effect-Conclusion-Continue",
                "theory_doc": "7. Структура EECC.docx.txt",
                "situations": [
                    "Подготовьте EECC для сотрудника, который хорошо справляется с задачами, но не проявляет инициативу за пределами своей роли.",
                    "Сотрудник ожидал маркер 'Готов к продвижению', но получил 'Развивается в роли'. Подготовьте EECC для объяснения разрыва.",
                ]
            },
            {
                "id": "skill_2_8",
                "name": "Предположение возражений сотрудника",
                "description": "Умение заранее предвидеть возможные возражения и подготовить ответы на них",
                "theory_doc": "8. Основные возражения сотрудника по итогам Performance review.docx.txt",
                "situations": [
                    "Сотрудник не выполнил KPI. Какие возражения он может привести и как подготовиться к ним заранее?",
                    "Вы снижаете оценку сотруднику, который считает себя лучшим в команде. Какие возражения предвидеть?",
                ]
            },
            {
                "id": "skill_2_9",
                "name": "Выбор фокусных компетенций для развития",
                "description": "Умение выбрать 2-3 ключевые компетенции для обсуждения на встрече",
                "theory_doc": "5. Как развиваются компетенции.docx.txt",
                "situations": [
                    "У сотрудника 5 зон роста по результатам оценки. Как выбрать 2-3 фокусные компетенции для обсуждения на ревью?",
                    "Сотрудник хочет развивать технические навыки, но ему критичнее soft skills. Как выбрать фокус для встречи?",
                ]
            },
        ]
    },
    "block_3": {
        "id": "block_3",
        "name": "Проведение встречи",
        "name_en": "Conducting the Meeting",
        "description": "Навыки проведения ревью-встречи с сотрудником",
        "skills": [
            {
                "id": "skill_3_10",
                "name": "Установление контакта в начале встречи",
                "description": "Умение создать доверительную атмосферу и безопасную среду в начале встречи",
                "theory_doc": "11. (для теории, с примерами) Цели и задачи этапов встречи.docx.txt",
                "situations": [
                    "Сотрудник пришёл на ревью напряжённым — он явно ожидает плохих новостей. Как начать встречу, чтобы снизить тревогу и установить контакт?",
                    "Это первое ревью с новым сотрудником. Как объяснить формат и цель встречи, чтобы он не воспринял её как 'суд'?",
                ]
            },
            {
                "id": "skill_3_11",
                "name": "Распознавание базовых эмоций по контексту",
                "description": "Умение распознавать эмоциональное состояние сотрудника по вербальным и невербальным сигналам",
                "theory_doc": "9. Рекомендации по работе с проявлениями ключевых типов эмоций.docx.txt",
                "situations": [
                    "Сотрудник отвечает короткими фразами, избегает зрительного контакта и сидит со скрещенными руками. Какую эмоцию он испытывает и как на это реагировать?",
                    "Сотрудник улыбается и говорит 'всё хорошо', но его голос дрожит. Как распознать истинное эмоциональное состояние?",
                ]
            },
            {
                "id": "skill_3_12",
                "name": "Возврат в конструктивное русло при эмоциональных проявлениях",
                "description": "Умение работать с сильными эмоциями и возвращать разговор в конструктивное русло",
                "theory_doc": "9. Принципы работы с эмоциями.docx.txt",
                "situations": [
                    "Сотрудник злится и повышает голос: 'Это несправедливо! Я работал больше всех!'. Как вернуть разговор в конструктивное русло?",
                    "Сотрудник расплакался после объявления оценки и не может продолжать разговор. Как действовать?",
                ]
            },
            {
                "id": "skill_3_13",
                "name": "Развивающий диалог и формирование целей развития",
                "description": "Умение вести диалог о развитии и совместно формулировать цели",
                "theory_doc": "11. (для теории, с примерами) Цели и задачи этапов встречи.docx.txt",
                "situations": [
                    "После объявления оценки сотрудник расстроен и говорит: 'Зачем мне ИПР, если всё равно не повысят?'. Как перевести разговор в развивающее русло?",
                    "Сотрудник не знает, чего хочет от карьеры. Как через диалог помочь ему сформулировать цели развития?",
                ]
            },
            {
                "id": "skill_3_14",
                "name": "Работа с возражениями",
                "description": "Умение конструктивно работать с возражениями сотрудника во время встречи",
                "theory_doc": "8. Основные возражения сотрудника по итогам Performance review.docx.txt",
                "situations": [
                    "Сотрудник говорит: 'Я не выполнил KPI только потому, что смежный отдел меня подвёл. Это несправедливая оценка!'. Как работать с этим возражением?",
                    "Сотрудник настаивает: 'Ты же весь год говорил, что всё хорошо! Почему теперь такая оценка?'. Как ответить?",
                ]
            },
        ]
    }
}


def get_all_blocks() -> List[Dict[str, Any]]:
    """Return list of all blocks with basic info."""
    return [
        {
            "id": block["id"],
            "name": block["name"],
            "name_en": block["name_en"],
            "description": block["description"],
            "skills_count": len(block["skills"])
        }
        for block in SKILL_BLOCKS.values()
    ]


def get_block(block_id: str) -> Dict[str, Any] | None:
    """Return a specific block with all skills."""
    return SKILL_BLOCKS.get(block_id)


def get_skill(block_id: str, skill_id: str) -> Dict[str, Any] | None:
    """Return a specific skill from a block."""
    block = SKILL_BLOCKS.get(block_id)
    if not block:
        return None
    for skill in block["skills"]:
        if skill["id"] == skill_id:
            return skill
    return None


def get_all_skills_flat() -> List[Dict[str, Any]]:
    """Return all skills as a flat list with block info."""
    skills = []
    for block in SKILL_BLOCKS.values():
        for skill in block["skills"]:
            skills.append({
                **skill,
                "block_id": block["id"],
                "block_name": block["name"]
            })
    return skills
